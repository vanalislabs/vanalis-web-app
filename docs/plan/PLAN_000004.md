# PLAN_000004: Navbar Search Modal Component

## Deskripsi Singkat

Membuat komponen search modal di navbar yang menampilkan hasil pencarian real-time untuk projects, datasets, dan users. Komponen ini terinspirasi dari marketplace NFT seperti OpenSea, TradePort, TokoMall, dan Magic Eden, dimana ketika user klik search box, langsung muncul modal dengan search input, filter buttons, dan hasil pencarian yang dikelompokkan berdasarkan kategori.

**Konteks dari User:**
> "Bantu aku bikin component ketika user search di navbar itu kurang lebih mirip2 kayak gini aplikasi ini kalo user mau nge search [OpenSea, TradePort, TokoMall, Magic Eden]. Jadi kayak muncul hasil search nya gitu"

**Update dari User:**
> "Coba cek lagi @PLAN_000004.md sebenernya aku pinginnya itu model yang kita gk perlu ngetik, tapi ketika kita udah klik search box nya itu udah muncul kayak modal gitu gk sih kalo kita liat @Browser https://opensea.io/ http://magiceden.io/"

**Analisis OpenSea & Magic Eden:**
- **OpenSea**: Ketika search box diklik, langsung muncul modal dengan filter buttons (All, Collections, Tokens, Items, Wallets) dan search input di dalam modal
- **Magic Eden**: Ketika search box diklik, langsung muncul modal dengan search input di dalam modal
- **Kesimpulan**: Modal muncul langsung tanpa perlu mengetik dulu, search input berada di dalam modal dengan auto-focus

**Konsistensi dengan Product Brief:**
- **Search Feature:** Sudah tercakup di PRODUCT_BRIEF.md (line 112) sebagai "Global search functionality untuk mencari projects, datasets, dan users dengan real-time dropdown results (terinspirasi OpenSea)". Search akan mencakup:
  - **Projects:** Dari halaman Projects (crowdsourcing phase)
  - **Datasets:** Dari Marketplace (dataset final yang sudah dikurasi)
  - **Users:** Profil publik user lain (Contributors, Curators, Trainers)
- **Profile System:** Sudah disebutkan di PRODUCT_BRIEF.md (line 115) sebagai "Public profile dengan stats, earnings, dan history (user dapat melihat profil user lain)". ProfilePage sudah diimplementasikan dengan route `/profile/:address`, sehingga user dapat melihat profil user lain. Search untuk users akan mengarah ke route ini.

## File yang Perlu Diubah atau Dibuat

### File Baru yang Perlu Dibuat:
1. `src/components/SearchModal.tsx` - Komponen utama search modal (seperti OpenSea/Magic Eden)
2. `src/components/SearchResultItem.tsx` - Komponen item hasil pencarian (reusable untuk project/dataset/user)
3. `src/hooks/useSearch.ts` - Custom hook untuk search logic dengan debounce dan TanStack Query
4. `src/types/search.ts` - Type definitions untuk search results
5. `src/services/searchService.ts` - Service layer untuk search API calls (mock untuk sekarang)

### File yang Perlu Diubah:
1. `src/components/Navbar.tsx` - Integrasi SearchModal component (search input menjadi readOnly trigger)
2. `src/components/ui/dialog.tsx` (sudah ada) - Untuk modal container

## Algoritma dan Implementasi

### 1. Search Modal Component Structure

Komponen `SearchModal` akan memiliki struktur (seperti OpenSea/Magic Eden):
- **Modal Container**: Dialog/Modal yang muncul ketika search box diklik (tanpa perlu mengetik)
- **Search Input Header**: Input field dengan icon search di dalam modal (auto-focus)
- **Filter Buttons**: Filter buttons untuk kategori (All, Projects, Datasets, Users)
- **Results Container**: Scrollable container dengan max-height
- **Grouped Results**: Hasil pencarian dikelompokkan dalam sections:
  - Projects section
  - Datasets section  
  - Users section
- **Empty State**: Pesan ketika belum mengetik atau tidak ada hasil
- **Loading State**: Skeleton atau spinner saat fetching

### 2. Search Logic dengan Debounce

Menggunakan custom hook `useSearch` yang:
- Menerima query string dari input
- Menggunakan debounce (300-500ms) untuk mengurangi API calls
- Menggunakan TanStack Query untuk data fetching dan caching
- Mengembalikan grouped results (projects, datasets, users)
- Handle loading dan error states

### 3. Search Result Item Component

Komponen `SearchResultItem` akan menampilkan:
- **Image/Icon**: Thumbnail untuk project/dataset, avatar untuk user
- **Title/Name**: Nama project, dataset, atau username
- **Metadata**: 
  - Project: status badge, reward amount, submissions count
  - Dataset: price, items count, category
  - User: roles, address (truncated)
- **Navigation**: Link ke detail page saat diklik

### 4. Keyboard Navigation

Implementasi keyboard navigation:
- **Arrow Up/Down**: Navigate antara items
- **Enter**: Select item dan navigate
- **Escape**: Close modal
- Auto-focus search input ketika modal dibuka

### 5. Modal Behavior

- Modal muncul langsung ketika search box diklik (tanpa perlu mengetik)
- Modal menutup ketika user klik outside overlay, tekan Escape, atau pilih hasil
- Search input di navbar menjadi readOnly dan hanya trigger modal
- Search input sebenarnya berada di dalam modal dengan auto-focus

### 6. Styling sesuai Design Guidelines

Mengikuti design guidelines (OpenSea/Magic Eden-inspired):
- **Modal Container**: 
  - `bg-white dark:bg-gray-900`
  - `rounded-xl`
  - `shadow-2xl`
  - `border border-gray-200 dark:border-gray-800`
  - Max width: `max-w-2xl`
  - Max height: `max-h-[80vh]` dengan scrollable
  - Positioned di tengah atas dengan overlay backdrop
- **Filter Buttons**:
  - Active state dengan variant "default"
  - Inactive state dengan variant "ghost"
  - Size "sm" dengan text-xs

- **Search Result Items**:
  - Hover effect: `hover:bg-gray-50 dark:hover:bg-gray-800`
  - Padding: `px-4 py-3`
  - Flex layout untuk image + content
  - Image: `w-12 h-12 rounded-lg` atau `aspect-square`
  - Typography: sesuai hierarchy (title: `font-semibold`, metadata: `text-sm text-muted-foreground`)

- **Group Headers**:
  - `text-xs font-medium text-muted-foreground`
  - `px-4 py-2`
  - Border separator antara groups

### 7. API Integration (Mock untuk Sekarang)

Karena backend API belum tersedia, akan menggunakan mock data:
- Mock service di `searchService.ts` yang return mock results
- Struktur response mengikuti format yang akan digunakan nanti:
  ```typescript
  {
    projects: ProjectSearchResult[],
    datasets: DatasetSearchResult[],
    users: UserSearchResult[]
  }
  ```
- Nanti bisa diganti dengan real API call ke backend

## Detail Implementasi per File

### `src/types/search.ts`
```typescript
export interface ProjectSearchResult {
  id: string;
  title: string;
  image: string;
  status: "open" | "closing-soon" | "completed";
  reward: string;
  submissions: number;
  curatorName: string;
}

export interface DatasetSearchResult {
  id: string;
  name: string;
  image: string;
  price: string;
  itemsCount: number;
  category: string;
}

export interface UserSearchResult {
  address: string;
  username: string;
  avatar?: string;
  roles: string[];
}

export interface SearchResults {
  projects: ProjectSearchResult[];
  datasets: DatasetSearchResult[];
  users: UserSearchResult[];
}
```

### `src/services/searchService.ts`
- Function `search(query: string): Promise<SearchResults>`
- Mock implementation dengan filter berdasarkan query
- Return maksimal 5-8 results per category untuk preview

### `src/hooks/useSearch.ts`
- Custom hook menggunakan `useQuery` dari TanStack Query
- Debounce query dengan `useDebouncedValue` atau custom debounce
- Return: `{ data, isLoading, error }`

### `src/components/SearchResultItem.tsx`
- Props: `type: 'project' | 'dataset' | 'user'`, `data`, `onClick`
- Conditional rendering berdasarkan type
- Link navigation ke detail page

### `src/components/SearchModal.tsx`
- Props: `open: boolean`, `onOpenChange`, `initialQuery?: string`
- Menggunakan Dialog component untuk modal
- Search input di dalam modal (bukan di navbar)
- Filter buttons untuk kategori (All, Projects, Datasets, Users)
- Render grouped results dengan custom sections
- Handle keyboard navigation
- Auto-focus search input ketika modal dibuka

### `src/components/Navbar.tsx`
- State untuk modal open/close
- Search input di navbar menjadi readOnly dan trigger modal
- Integrasi SearchModal component
- Handle click dan focus events untuk membuka modal

## Fase Implementasi

### Fase 1: Core Components (Data Layer)
1. Buat type definitions (`search.ts`)
2. Buat mock search service (`searchService.ts`)
3. Buat custom hook `useSearch` dengan TanStack Query

### Fase 2: UI Components
4. Buat `SearchResultItem` component
5. Buat `SearchModal` component dengan grouped results dan filter buttons
6. Implementasi keyboard navigation
7. Auto-focus search input di modal

### Fase 3: Integration
8. Integrasi SearchModal ke Navbar (search input menjadi readOnly trigger)
9. Styling sesuai design guidelines (OpenSea/Magic Eden inspired)
10. Testing dan refinement

## Acceptance Criteria

1. **Search Input Behavior:**
   - User dapat klik search input di navbar untuk membuka modal
   - Modal muncul langsung ketika search box diklik (tanpa perlu mengetik)
   - Search input di navbar menjadi readOnly dan hanya trigger modal
   - Search input sebenarnya berada di dalam modal dengan auto-focus
   - Modal menutup ketika user klik outside, tekan Escape, atau pilih hasil

2. **Search Results Display:**
   - Filter buttons (All, Projects, Datasets, Users) untuk memfilter hasil
   - Hasil pencarian ditampilkan dalam modal dengan grouping (Projects, Datasets, Users)
   - Setiap hasil menampilkan preview (image/avatar, title/name, metadata)
   - Maksimal 5-8 hasil per kategori untuk preview
   - Loading state ditampilkan saat fetching
   - Empty state ditampilkan ketika belum mengetik (minimal 2 karakter) atau tidak ada hasil

3. **Navigation:**
   - User dapat klik item untuk navigate ke detail page
   - Keyboard navigation (arrow keys, enter, escape) berfungsi dengan baik
   - Link navigation mengarah ke route yang benar:
     - Projects → `/projects/{id}` (ProjectDetailPage)
     - Datasets → `/marketplace/{id}` (DatasetDetailPage)
     - Users → `/profile/{address}` (ProfilePage - public profile user lain)
   - Semua route sudah ada di aplikasi dan dapat diakses tanpa autentikasi (public routes)

4. **Performance:**
   - Search query di-debounce (400ms) untuk mengurangi API calls
   - TanStack Query caching bekerja dengan baik
   - Modal tidak lag saat mengetik
   - useMemo untuk optimasi filteredData dan allResults

5. **Styling:**
   - Modal styling sesuai design guidelines (OpenSea/Magic Eden-inspired)
   - Responsive dan terlihat baik di mobile/tablet
   - Dark mode support
   - Hover states dan transitions smooth
   - Overlay backdrop dengan blur effect

6. **User Experience:**
   - Search results relevan dengan query
   - Preview informasi cukup informatif untuk user memutuskan
   - Visual feedback jelas (hover, selected state)
   - Tidak ada flickering atau layout shift

## Checklist

- [x] Create type definitions file `src/types/search.ts` with ProjectSearchResult, DatasetSearchResult, UserSearchResult, and SearchResults interfaces
- [x] Create mock search service `src/services/searchService.ts` with search function that returns filtered mock data
- [x] Create custom hook `src/hooks/useSearch.ts` with debounced query and TanStack Query integration
- [x] Create `SearchResultItem` component `src/components/SearchResultItem.tsx` with conditional rendering for project/dataset/user types
- [x] Create `SearchModal` component `src/components/SearchModal.tsx` with modal display, filter buttons, grouped results, keyboard navigation
- [x] Update `Navbar` component `src/components/Navbar.tsx` to integrate SearchModal (search input menjadi readOnly trigger)
- [x] Style SearchModal according to design guidelines (OpenSea/Magic Eden-inspired with proper spacing, shadows, borders, hover states)
- [x] Add loading state (skeleton or spinner) to SearchModal component
- [x] Add empty state message to SearchModal (ketika belum mengetik dan ketika tidak ada hasil)
- [x] Add filter buttons (All, Projects, Datasets, Users) to SearchModal
- [ ] Test keyboard navigation (arrow keys, enter, escape) in SearchModal
- [ ] Test click outside handler to close modal
- [ ] Test navigation links to correct routes (projects, datasets, users)
- [ ] Verify debounce functionality works correctly (no excessive API calls)
- [ ] Test responsive behavior on mobile/tablet devices
- [ ] Verify dark mode styling works correctly

