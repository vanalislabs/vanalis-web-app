# PLAN_000001: Preview-First Submission Review System untuk Project Owner/Curator

## Deskripsi Singkat

Implementasi fitur preview-first submission review system di `ProjectDetailPage` agar project owner/curator dapat melihat, review, approve, dan reject submission dari contributor. Fitur ini memungkinkan curator untuk:

1. Melihat daftar semua submissions yang masuk ke project mereka
2. Review preview dataset (sample data) yang sudah diupload contributor
3. Approve submission → membuka full dataset dan mendistribusikan reward
4. Reject submission → menolak submission dengan alasan

Sistem ini menggunakan **preview-first approach** dimana:
- **Preview dataset** = sample data representatif dari full dataset (accessible langsung untuk review)
- **Full dataset** = data lengkap yang locked sampai approve
- Curator hanya perlu review preview untuk efisiensi, tidak perlu download full dataset

## File dan Fungsi yang Perlu Diubah/Dibuat

### File Baru yang Perlu Dibuat:

1. **`src/components/SubmissionCard.tsx`**
   - Komponen card untuk menampilkan submission dalam list
   - Menampilkan: contributor info, submission title, status badge, preview thumbnail, submitted date, reward amount
   - Action buttons: View Details, Approve, Reject (conditional berdasarkan status)

2. **`src/components/SubmissionDetailDialog.tsx`** atau **`src/components/SubmissionReviewModal.tsx`**
   - Modal/Dialog untuk review detail submission
   - Menampilkan: full metadata, preview dataset viewer, contributor info
   - Action buttons: Approve, Reject dengan confirmation

3. **`src/components/PreviewDatasetViewer.tsx`** (opsional, bisa diintegrasikan ke SubmissionDetailDialog)
   - Komponen untuk menampilkan preview dataset
   - Support untuk: image preview (gallery), file list, download preview
   - Handle berbagai format data (images, text files, dll)

### File yang Perlu Diubah:

1. **`src/pages/ProjectDetailPage.tsx`**
   - Tambahkan tab "Submissions" di Tabs component (hanya visible untuk project owner)
   - Tambahkan state untuk submissions list dan filter
   - **Mock data:** Tambahkan mock submissions data di dalam component (belum ada API integration)
   - Tambahkan handler untuk approve/reject submission (mock state update saja)
   - Update sidebar stats untuk menampilkan submission counts (pending, approved, rejected)

2. **`src/pages/SubmitDataPage.tsx`** (opsional, untuk future enhancement)
   - Update form untuk upload 2 file terpisah (preview + full dataset)
   - Update UI untuk menjelaskan preview-first system (bukan commit-reveal)

## Algoritma dan Langkah-Langkah Implementasi

### 1. Data Structure untuk Submission

```typescript
interface Submission {
  id: string;
  projectId: string;
  contributorName: string;
  contributorAddress: string;
  contributorAvatar?: string;
  title: string;
  description: string;
  tags?: string[];
  status: 'pending' | 'approved' | 'rejected';
  previewDatasetUrl: string; // URL untuk preview dataset (accessible langsung)
  fullDatasetUrl?: string; // URL untuk full dataset (null jika belum approved)
  previewDatasetSize?: string; // Size preview dataset
  fullDatasetSize?: string; // Size full dataset
  submittedAt: string; // ISO date atau relative time
  reviewedAt?: string; // ISO date atau relative time
  rejectedReason?: string; // Alasan reject (jika rejected)
  reward: string; // Reward amount (e.g., "5 SUI")
}
```

### 2. Flow Review Submission

**Step 1: Curator membuka ProjectDetailPage**
- Check `isProjectOwner` → jika true, tampilkan tab "Submissions"
- Load mock submissions data untuk project tersebut (filter by projectId)
- **Catatan:** Menggunakan mock data, belum ada API integration
- Tampilkan list submissions dengan status filter (All, Pending, Approved, Rejected)

**Step 2: Curator melihat list submissions**
- Tampilkan SubmissionCard untuk setiap submission
- Setiap card menampilkan:
  - Contributor info (avatar, name, address)
  - Submission title dan description (truncated)
  - Status badge (pending/approved/rejected)
  - Preview thumbnail atau icon
  - Submitted date
  - Reward amount
  - Action buttons (View Details, Approve, Reject) - conditional berdasarkan status

**Step 3: Curator review submission**
- Click "View Details" → buka SubmissionDetailDialog
- Dialog menampilkan:
  - Full metadata (title, description, tags)
  - Preview dataset viewer (bisa preview images, download preview, dll)
  - Contributor info
  - Submission timeline (submitted at, reviewed at jika sudah)
  - Action buttons: Approve, Reject

**Step 4: Curator approve submission**
- Click "Approve" button
- Show confirmation dialog: "Are you sure you want to approve this submission? This will unlock the full dataset and distribute the reward."
- On confirm:
  - Update submission status to 'approved' (mock state update)
  - Set `fullDatasetUrl` (mock unlock full dataset)
  - Set `reviewedAt` timestamp
  - **Mock reward distribution:** Update UI state saja (belum ada smart contract integration)
  - Update UI: hide Approve button, show Approved badge
  - Update submission counts di sidebar stats

**Step 5: Curator reject submission**
- Click "Reject" button
- Show dialog dengan input field untuk rejection reason (required)
- On confirm:
  - Update submission status to 'rejected' (mock state update)
  - Set `rejectedReason`
  - Set `reviewedAt` timestamp
  - Keep `fullDatasetUrl` as null (full dataset tetap locked)
  - Update UI: hide Approve/Reject buttons, show Rejected badge dengan reason
  - Update submission counts di sidebar stats

### 3. UI/UX Considerations

- **Status Badges:**
  - Pending: Yellow badge dengan Clock icon
  - Approved: Green badge dengan CheckCircle icon
  - Rejected: Red badge dengan XCircle icon

- **Preview Dataset Viewer:**
  - Jika preview adalah images: tampilkan image gallery dengan thumbnail grid
  - Jika preview adalah files: tampilkan file list dengan download button
  - Support untuk berbagai format (images, text, dll)

- **Filter & Search:**
  - Filter by status: All, Pending, Approved, Rejected
  - Search by contributor name atau submission title (future enhancement)

- **Responsive Design:**
  - SubmissionCard: stack layout di mobile, grid di desktop
  - SubmissionDetailDialog: full screen di mobile, centered modal di desktop

### 4. Integration Points (Future)

**Catatan:** Saat ini implementasi menggunakan **mock data** saja. Backend API belum tersedia dan endpoint belum diketahui. Semua data submissions, approve/reject actions, dan statistik menggunakan mock data di frontend.

- **Backend API Integration (Future - Backend belum tersedia):**
  - Endpoint untuk fetch submissions belum diketahui (akan diintegrasikan nanti)
  - Endpoint untuk approve/reject submission belum diketahui (akan diintegrasikan nanti)
  - **Saat ini:** Semua data menggunakan mock data di frontend
  - **Struktur mock data:** Menggunakan interface `Submission` yang sudah didefinisikan, mudah diganti dengan API calls nanti

- **Blockchain Integration (Future):**
  - Approve submission → trigger smart contract untuk unlock full dataset
  - Approve submission → trigger reward distribution via smart contract
  - **Saat ini:** Mock reward distribution (hanya update UI state)

- **Storage Integration (Future):**
  - Preview dataset URL dari Walrus storage
  - Full dataset URL dari Walrus storage (unlocked setelah approve)
  - **Saat ini:** Mock URL atau placeholder untuk preview/full dataset

## Checklist

- [x] Buat komponen `SubmissionCard.tsx` dengan props untuk menampilkan submission info, status badge, dan action buttons
- [x] Buat komponen `SubmissionDetailDialog.tsx` dengan preview dataset viewer dan approve/reject actions
- [x] Buat komponen `PreviewDatasetViewer.tsx` untuk menampilkan preview dataset (support image gallery dan file list)
- [x] Tambahkan tab "Submissions" di `ProjectDetailPage.tsx` (hanya visible untuk `isProjectOwner === true`)
- [x] Implementasi state management untuk submissions list dan filter (All, Pending, Approved, Rejected)
- [x] Tambahkan mock data untuk submissions di `ProjectDetailPage.tsx` dengan struktur sesuai interface Submission
- [x] Implementasi handler `handleApproveSubmission` dengan confirmation dialog
- [x] Implementasi handler `handleRejectSubmission` dengan reason input dan confirmation dialog
- [x] Update sidebar stats di `ProjectDetailPage.tsx` untuk menampilkan submission counts (pending, approved, rejected)
- [x] Update UI untuk menampilkan status badges dan conditional rendering action buttons berdasarkan status
- [x] Test UI flow: view submissions → review detail → approve/reject → verify UI updates
- [x] Pastikan responsive design untuk mobile dan desktop

## Acceptance Criteria

### Functional Requirements:

1. **Project Owner/Curator dapat melihat list submissions:**
   - Tab "Submissions" hanya visible untuk project owner (`isProjectOwner === true`)
   - List menampilkan semua submissions untuk project tersebut
   - Setiap submission menampilkan: contributor info, title, status, preview thumbnail, submitted date, reward

2. **Project Owner/Curator dapat filter submissions:**
   - Filter by status: All, Pending, Approved, Rejected
   - Filter bekerja dengan benar dan update list sesuai status

3. **Project Owner/Curator dapat review submission detail:**
   - Click "View Details" membuka dialog dengan full metadata
   - Preview dataset dapat dilihat/di-download dari dialog
   - Dialog menampilkan contributor info dan submission timeline

4. **Project Owner/Curator dapat approve submission:**
   - Approve button hanya visible untuk submissions dengan status "pending"
   - Approve button membuka confirmation dialog
   - Setelah approve: status berubah ke "approved" (mock state update), full dataset unlocked (mock), reward distributed (mock - hanya UI update), UI update sesuai

5. **Project Owner/Curator dapat reject submission:**
   - Reject button hanya visible untuk submissions dengan status "pending"
   - Reject button membuka dialog dengan reason input (required)
   - Setelah reject: status berubah ke "rejected", rejected reason ditampilkan, full dataset tetap locked, UI update sesuai

6. **Stats di sidebar update sesuai submission status:**
   - Submission counts (pending, approved, rejected) ditampilkan di sidebar stats
   - Counts update real-time setelah approve/reject

### UI/UX Requirements:

1. **Design consistency:**
   - Mengikuti design system yang sudah ada (TailwindCSS, shadcn/ui components)
   - Status badges menggunakan warna yang konsisten (yellow=pending, green=approved, red=rejected)
   - Icons menggunakan Lucide React

2. **Responsive design:**
   - SubmissionCard responsive untuk mobile dan desktop
   - SubmissionDetailDialog responsive (full screen di mobile, modal di desktop)
   - Preview dataset viewer responsive

3. **User feedback:**
   - Loading states saat approve/reject
   - Success/error messages setelah approve/reject
   - Confirmation dialogs untuk prevent accidental actions

### Technical Requirements:

1. **Type safety:**
   - Semua components menggunakan TypeScript dengan proper types
   - Interface Submission didefinisikan dan digunakan konsisten

2. **Code organization:**
   - Components di folder `src/components/`
   - Reusable components untuk submission-related UI
   - **Mock data:** Semua data submissions menggunakan mock data di frontend, terpisah dan mudah diganti dengan API calls nanti (backend belum tersedia)

3. **Accessibility:**
   - Proper ARIA labels untuk buttons dan dialogs
   - Keyboard navigation support
   - Screen reader friendly

